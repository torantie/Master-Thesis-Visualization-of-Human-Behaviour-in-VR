Base implementation, sligthly edited from:

https://gist.github.com/darktable/2317063#file-savwav-cs